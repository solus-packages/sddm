name       : sddm
version    : 0.15.0
release    : 1
source     :
    - https://github.com/sddm/sddm/releases/download/v0.15.0/sddm-0.15.0.tar.gz : a4211e5b66f674415e07bc1cc39c16f60ae6025418bcbaba1118cd51e57c3174
license    :
    - CC-BY-3.0
    - GPL-2.0
component  : desktop
summary    : Modern display manager for X11 and Wayland
description: |
    SDDM is a modern display manager for X11 and Wayland aiming to be fast, simple and beautiful. It uses modern technologies like QtQuick, which in turn gives the designer the ability to create smooth, animated user interfaces.
builddeps  :
    - pkgconfig(gl)
    - pkgconfig(Qt5Help)
    - pkgconfig(Qt5Qml)
    - pkgconfig(xcb)
    - extra-cmake-modules
rundeps    :
    - breeze
setup      : |
    # Upstream patches
    %patch -p1 < $pkgfiles/0001-Load-configuration-information-from-config-directori.patch
    %patch -p1 < $pkgfiles/0013-Load-config-from-usr-lib-sddm-sddm.conf.d-before-etc.patch

    %patch -p1 < $pkgfiles/0001-Use-Solus-default-stateless-paths.patch
    %cmake -DCMAKE_INSTALL_LIBEXECDIR=%libdir%/%PKGNAME% \
           -DSYSTEMD_SYSTEM_UNIT_DIR=%libdir%/systemd/system .
build      : |
    %make
install    : |
    %make_install
    # Start by default
    install -d -m 00755 $installdir/%libdir%/systemd/system/graphical.target.wants
    ln -s %libdir%/systemd/system/sddm.service $installdir/%libdir%/systemd/system/displaymanager.service
    ln -s %libdir%/systemd/system/sddm.service $installdir/%libdir%/systemd/system/graphical.target.wants/sddm.service

    install -D -m 00644 $pkgfiles/sddm.sysusers $installdir/%libdir%/sysusers.d/sddm.conf
    install -D -m 00644 $pkgfiles/sddm.tmpfiles $installdir/%libdir%/tmpfiles.d/sddm.conf
    install -D -m 00644 $pkgfiles/sddm.pam $installdir/etc/pam.d/sddm
    install -D -m 00644 $pkgfiles/sddm-autologin.pam $installdir/etc/pam.d/sddm-autologin
    install -D -m 00644 $pkgfiles/sddm.conf $installdir/usr/share/sddm/sddm.conf.d/10_solus_default.conf

    # Already ships our default config
    rm $installdir/etc/sddm.conf
    cd $installdir; qml_cache
