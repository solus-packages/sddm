From 11b148ccc2c6e9b9c44976f52fd2f5bdb78e21cd Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@streambits.io>
Date: Fri, 18 Dec 2020 13:06:07 +0200
Subject: [PATCH 1/1] Revert "Don't abort on failure to start the display
 server"

This reverts commit 74394fd1cff26b0516af87539906a31bf2f49825.
---
 src/daemon/Display.cpp | 11 +++++++++--
 src/daemon/Display.h   |  2 +-
 src/daemon/Seat.cpp    |  9 ++-------
 src/daemon/Seat.h      |  2 +-
 4 files changed, 13 insertions(+), 11 deletions(-)

diff --git a/src/daemon/Display.cpp b/src/daemon/Display.cpp
index b95f6e5..a565e38 100644
--- a/src/daemon/Display.cpp
+++ b/src/daemon/Display.cpp
@@ -101,8 +101,15 @@ namespace SDDM {
         return m_seat;
     }
 
-    bool Display::start() {
-        return m_started || m_displayServer->start();
+    void Display::start() {
+        // check flag
+        if (m_started)
+            return;
+
+        // start display server
+        if (!m_displayServer->start()) {
+            qFatal("Display server failed to start. Exiting");
+        }
     }
 
     bool Display::attemptAutologin() {
diff --git a/src/daemon/Display.h b/src/daemon/Display.h
index e68bc12..a6a06b2 100644
--- a/src/daemon/Display.h
+++ b/src/daemon/Display.h
@@ -54,7 +54,7 @@ namespace SDDM {
         Seat *seat() const;
 
     public slots:
-        bool start();
+        void start();
         void stop();
 
         void login(QLocalSocket *socket,
diff --git a/src/daemon/Seat.cpp b/src/daemon/Seat.cpp
index eef26da..c7a9b67 100644
--- a/src/daemon/Seat.cpp
+++ b/src/daemon/Seat.cpp
@@ -52,7 +52,7 @@ namespace SDDM {
         return m_name;
     }
 
-    bool Seat::createDisplay(int terminalId) {
+    void Seat::createDisplay(int terminalId) {
         //reload config if needed
         mainConfig.load();
 
@@ -84,12 +84,7 @@ namespace SDDM {
         m_displays << display;
 
         // start the display
-        if (!display->start()) {
-            qCritical() << "Could not start Display server on vt" << terminalId;
-            return false;
-        }
-
-        return true;
+        display->start();
     }
 
     void Seat::removeDisplay(Display* display) {
diff --git a/src/daemon/Seat.h b/src/daemon/Seat.h
index bf22566..53ab2f2 100644
--- a/src/daemon/Seat.h
+++ b/src/daemon/Seat.h
@@ -35,7 +35,7 @@ namespace SDDM {
         const QString &name() const;
 
     public slots:
-        bool createDisplay(int terminalId = -1);
+        void createDisplay(int terminalId = -1);
         void removeDisplay(SDDM::Display* display);
 
     private slots:
-- 
2.29.2

